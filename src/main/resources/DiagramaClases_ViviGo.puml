@startuml DiagramaClasesViviGo
'Diagrama de Clases - ViviGo (Entidades y Relaciones)
class Usuario {
  +Long id
  +String nombre
  +String email
  +String passwordHash
  +String telefono
  +String rol
  +PerfilAnfitrion perfilAnfitrion
  +LocalDate fechaNacimiento
  +LocalDateTime fechaCreacion
  +String fotoUrl
}

class PerfilAnfitrion {
  +String descripcion
  +List<String> documentosUrls
}


class Ubicacion {
  +String ciudad
  +String direccion
}

class Alojamiento {
  +Long id
  +String titulo
  +String descripcion
  +Double precioNoche
  +Integer capacidad
  +AlojamientoEstado estado
  +LocalDateTime fechaCreacion
  +Set Servicio
}

class Imagen {
  +Long id
  +String url
  +Integer orden
  +Boolean esPrincipal
}

enum Servicio {
  RESTAURANTE
  INTERNET
  PISCINA
}
Servicio --|> Alojamiento

class Reserva {
  +Long id
  +LocalDate fechaEntrada
  +LocalDate fechaSalida
  +Integer numeroHuespedes
  +Double precioTotal
  +ReservaEstado estado
  +LocalDateTime fechaCreacion
  +LocalDateTime fechaCancelacion
}

class Comentario {
  +Long id
  +Integer calificacion
  +String texto
  +LocalDateTime fechaComentario
  +String respuestaHost  ' (nullable)
}

class Chat {
  +Long id
}

class Mensaje {
  +Long id
  +String contenido
  +LocalDateTime fechaEnvio
  +Boolean leido
}

class Localizacion {
  +Double latitud
  +Double longitud
}

enum AlojamientoEstado {
  ACTIVO
  ELIMINADO
}
AlojamientoEstado --|> Alojamiento

enum ReservaEstado {
  PENDIENTE
  CONFIRMADA
  CANCELADA
  COMPLETADA
}
ReservaEstado --|> Reserva


' Associations and multiplicities
Usuario "1" -- "*" Reserva : hace >
PerfilAnfitrion "1"--"1" Usuario : tiene
Alojamiento "1" -- "*" Reserva : recibe >
Usuario "1" -- "*" Alojamiento : posee >
Alojamiento "1" -- "1" Ubicacion : tiene >
Alojamiento "1" -- "*" Imagen : posee >
Reserva "1" -- "0..1" Comentario : puede_generar >
Reserva "1" -- "1" Chat : asociada_a >
Chat "1" -- "*" Mensaje : contiene >
Usuario "1" -- "*" Comentario : escribe >
Usuario "1" -- "*" Mensaje : envia >
Ubicacion "1" -- "1" Localizacion : tiene

' Constraints / Business rules (notes)
note right of Alojamiento
  - Imágenes: 1..10 por alojamiento.
  - Eliminación lógica: estado = ELIMINADO (soft-delete).
  - Búsquedas deben ignorar alojamientos eliminados.
end note

note left of Reserva
  - Validaciones al crear reserva:
    * fechaEntrada < fechaSalida
    * mínimo 1 noche
    * no reservar fechas pasadas
    * numeroHuespedes <= Alojamiento.capacidad
    * no solapamiento con otras reservas confirmadas
end note

note bottom of Comentario
  - Solo se permite 1 comentario por reserva y solo si la reserva está COMPLETADA.
  - El anfitrión puede responder (campo respuestaHost).
end note

@enduml
